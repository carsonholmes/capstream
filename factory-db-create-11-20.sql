-- MySQL Script generated by MySQL Workbench
-- Wed Nov 20 14:58:20 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema factory
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema factory
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `factory` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `factory` ;

-- -----------------------------------------------------
-- Table `factory`.`country`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`country` (
  `idCountry` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `isoCode` CHAR(2) NOT NULL,
  `active` BIT(1) NOT NULL,
  PRIMARY KEY (`idCountry`))
ENGINE = InnoDB
AUTO_INCREMENT = 247
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`province`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`province` (
  `idProvince` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `idCountry` INT NOT NULL,
  `name` VARCHAR(45) NOT NULL,
  `abbr` CHAR(2) NOT NULL,
  `active` BIT(1) NOT NULL,
  PRIMARY KEY (`idProvince`))
ENGINE = InnoDB
AUTO_INCREMENT = 73
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`location`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`location` (
  `idLocation` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `addressLine1` VARCHAR(255) NOT NULL,
  `addressLine2` VARCHAR(255) NOT NULL,
  `city` VARCHAR(255) NOT NULL,
  `idProvince` INT UNSIGNED NOT NULL,
  `idCountry` INT UNSIGNED NOT NULL,
  `postalCode` VARCHAR(12) NOT NULL,
  PRIMARY KEY (`idLocation`),
  UNIQUE INDEX `idLocation_UNIQUE` (`idLocation` ASC) VISIBLE,
  INDEX `fkLocationProvince` (`idProvince` ASC) VISIBLE,
  INDEX `fkLocationCountry` (`idCountry` ASC) VISIBLE,
  CONSTRAINT `fkLocationCountry`
    FOREIGN KEY (`idCountry`)
    REFERENCES `factory`.`country` (`idCountry`),
  CONSTRAINT `fkLocationProvince`
    FOREIGN KEY (`idProvince`)
    REFERENCES `factory`.`province` (`idProvince`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`address`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`address` (
  `idAddress` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `recipient` VARCHAR(100) NOT NULL,
  `idLocation` BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (`idAddress`),
  INDEX `fkLocationAddress` (`idLocation` ASC) VISIBLE,
  CONSTRAINT `fkLocationAddress`
    FOREIGN KEY (`idLocation`)
    REFERENCES `factory`.`location` (`idLocation`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`alphacode`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`alphacode` (
  `idAlphaCode` INT NOT NULL AUTO_INCREMENT,
  `code` VARCHAR(7) NOT NULL,
  `value` FLOAT NOT NULL,
  `used` TINYINT(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`idAlphaCode`))
ENGINE = InnoDB
AUTO_INCREMENT = 5
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`entity`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`entity` (
  `idEntity` BINARY(16) NOT NULL,
  `entityTitle` VARCHAR(255) NULL DEFAULT NULL,
  `entityDesc` TEXT NULL DEFAULT NULL,
  `entityType` INT NOT NULL,
  `idMedia` BIGINT UNSIGNED NULL DEFAULT NULL,
  `dtCreated` DATETIME NOT NULL,
  `dtLastEdited` DATETIME NULL DEFAULT NULL,
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEntity` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`app`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`app` (
  `idEntity` BINARY(16) NOT NULL,
  `appName` VARCHAR(58) NOT NULL,
  `appCode` VARCHAR(64) NOT NULL,
  `port` VARCHAR(5) NOT NULL,
  `dtCreated` DATETIME NOT NULL,
  `dtUpdated` DATETIME NOT NULL,
  `cloneUrl` VARCHAR(255) NULL DEFAULT NULL,
  `version` INT NULL DEFAULT NULL,
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idx_appCode` (`appCode` ASC) VISIBLE,
  CONSTRAINT `app_ibfk_1`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`cart`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`cart` (
  `idEntity` BINARY(16) NOT NULL,
  `idUser` BINARY(16) NOT NULL,
  `quantity` INT UNSIGNED NULL DEFAULT NULL,
  `idOffer` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`idEntity`, `idUser`),
  INDEX `fkUserCart` (`idUser` ASC) VISIBLE,
  CONSTRAINT `fkEntityCart`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`),
  CONSTRAINT `fkUserCart`
    FOREIGN KEY (`idUser`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`contacts`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`contacts` (
  `ContactID` INT NOT NULL AUTO_INCREMENT,
  `FirstName` VARCHAR(255) NULL DEFAULT NULL,
  `LastName` VARCHAR(255) NULL DEFAULT NULL,
  PRIMARY KEY (`ContactID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`credit-card`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`credit-card` (
  `idCreditCard` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `number` VARCHAR(16) NOT NULL,
  `expiration` DATE NOT NULL,
  `ccv` VARCHAR(4) NOT NULL,
  `idAddressBilling` BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (`idCreditCard`),
  INDEX `fkAddressCreditCard` (`idAddressBilling` ASC) VISIBLE,
  CONSTRAINT `fkAddressCreditCard`
    FOREIGN KEY (`idAddressBilling`)
    REFERENCES `factory`.`address` (`idAddress`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`email`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`email` (
  `idEmail` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEntity` BINARY(16) NOT NULL,
  `emailAddress` VARCHAR(320) NOT NULL,
  `emailVerified` TINYINT(1) NULL DEFAULT NULL,
  `emailVerifyCode` CHAR(6) NOT NULL,
  PRIMARY KEY (`idEmail`),
  UNIQUE INDEX `idEmail_UNIQUE` (`idEmail` ASC) VISIBLE,
  INDEX `fkEntityEmail_idx` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityEmail`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
AUTO_INCREMENT = 42
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`entity-area`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`entity-area` (
  `idEntity` BINARY(16) NOT NULL,
  `idAddress` INT NULL DEFAULT NULL,
  `postalCode` VARCHAR(12) NULL DEFAULT NULL,
  `mileRadius` INT NULL DEFAULT NULL,
  PRIMARY KEY (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`entity-media`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`entity-media` (
  `idMedia` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEntity` BINARY(16) NOT NULL,
  `idUser` BINARY(16) NOT NULL,
  `mediaType` INT UNSIGNED NOT NULL,
  `fileName` VARCHAR(50) NOT NULL,
  `dtCreated` DATETIME NOT NULL,
  `sortOrder` INT NOT NULL,
  `xOffset` FLOAT NULL DEFAULT '0',
  `yOffset` FLOAT NULL DEFAULT '0',
  `scale` FLOAT NULL DEFAULT '1',
  PRIMARY KEY (`idMedia`),
  INDEX `fkEntityEM_idx` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityEM`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
AUTO_INCREMENT = 112
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`entity-relate`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`entity-relate` (
  `idEntity` BINARY(16) NOT NULL,
  `idRelated` BINARY(16) NOT NULL,
  `relateType` INT NOT NULL,
  PRIMARY KEY (`idEntity`, `idRelated`, `relateType`),
  INDEX `fkEntityET2` (`idRelated` ASC) VISIBLE,
  CONSTRAINT `fkEntityET`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`),
  CONSTRAINT `fkEntityET2`
    FOREIGN KEY (`idRelated`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`event`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`event` (
  `idEvent` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEntity` BINARY(16) NOT NULL,
  `eventType` TINYINT NOT NULL,
  `dtStart` DATETIME NOT NULL,
  `dtEnd` DATETIME NULL DEFAULT NULL,
  `allDay` BIT(1) NOT NULL,
  `repeatType` TINYINT NOT NULL,
  `repeatTimeFrame` TINYINT NOT NULL,
  `repeatMonthlyType` TINYINT NOT NULL,
  `repeatInterval` SMALLINT NOT NULL,
  `repeatSun` BIT(1) NOT NULL,
  `repeatMon` BIT(1) NOT NULL,
  `repeatTue` BIT(1) NOT NULL,
  `repeatWed` BIT(1) NOT NULL,
  `repeatThu` BIT(1) NOT NULL,
  `repeatFri` BIT(1) NOT NULL,
  `repeatSat` BIT(1) NOT NULL,
  `repeatEndType` TINYINT NOT NULL,
  `repeatEnd` DATETIME NULL DEFAULT NULL,
  `repeatOccurences` SMALLINT NULL DEFAULT NULL,
  PRIMARY KEY (`idEvent`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEvent` ASC) VISIBLE,
  INDEX `fkEntityEvent` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityEvent`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
AUTO_INCREMENT = 26
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`event-chain-edit`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`event-chain-edit` (
  `idEventChainEdit` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEvent` INT UNSIGNED NOT NULL,
  `editType` TINYINT UNSIGNED NOT NULL,
  `dtStart` DATETIME NOT NULL,
  `idNewEvent` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`idEventChainEdit`),
  UNIQUE INDEX `idEventChainEdit_UNIQUE` (`idEventChainEdit` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`group`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`group` (
  `idEntity` BINARY(16) NOT NULL,
  `groupType` INT NOT NULL,
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityGroup`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`interaction`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`interaction` (
  `idInteraction` BIGINT NOT NULL AUTO_INCREMENT,
  `idEntity` BINARY(16) NOT NULL,
  `userPrompt` TEXT NULL DEFAULT NULL,
  `aiResponse` TEXT NULL DEFAULT NULL,
  `factoryAction` VARCHAR(255) NULL DEFAULT NULL,
  `actionParameter` VARCHAR(511) NULL DEFAULT NULL,
  `dtCreated` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `idApp` BINARY(16) NULL DEFAULT NULL,
  `systemResponse` TEXT NULL DEFAULT NULL,
  PRIMARY KEY (`idInteraction`),
  INDEX `idEntity` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `interaction_ibfk_1`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
AUTO_INCREMENT = 787
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`item`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`item` (
  `idEntity` BINARY(16) NOT NULL,
  `condition` INT NOT NULL,
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityItem`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`master-type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`master-type` (
  `idMasterType` INT NOT NULL AUTO_INCREMENT,
  `table` VARCHAR(100) NOT NULL,
  `column` VARCHAR(100) NOT NULL,
  `value` VARCHAR(255) NULL DEFAULT NULL,
  `code` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`idMasterType`))
ENGINE = InnoDB
AUTO_INCREMENT = 33
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`modify-code`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`modify-code` (
  `idModifyCode` BIGINT NOT NULL AUTO_INCREMENT,
  `idApp` BINARY(16) NOT NULL,
  `dtCreated` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `changeSummary` VARCHAR(2047) NULL DEFAULT NULL,
  `dbChanges` TEXT NULL DEFAULT NULL,
  `newClientImports` TEXT NULL DEFAULT NULL,
  `newServerImports` TEXT NULL DEFAULT NULL,
  `version` INT NULL DEFAULT NULL,
  `fixErrors` TINYINT(1) NULL DEFAULT '0',
  `errorText` TEXT NULL DEFAULT NULL,
  PRIMARY KEY (`idModifyCode`),
  INDEX `idApp` (`idApp` ASC) VISIBLE,
  CONSTRAINT `modify-code_ibfk_1`
    FOREIGN KEY (`idApp`)
    REFERENCES `factory`.`app` (`idEntity`))
ENGINE = InnoDB
AUTO_INCREMENT = 23
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`next-port`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`next-port` (
  `port` INT NOT NULL,
  PRIMARY KEY (`port`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`offer`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`offer` (
  `idOffer` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEntity` BINARY(16) NOT NULL,
  `offerType` SMALLINT NOT NULL,
  `confirmMethod` TINYINT NOT NULL,
  `price` FLOAT NOT NULL,
  `rateType` SMALLINT NOT NULL,
  `negotiable` TINYINT NOT NULL,
  `quantify` BIT(1) NULL DEFAULT NULL,
  `quantity` SMALLINT NOT NULL,
  PRIMARY KEY (`idOffer`),
  UNIQUE INDEX `idOffer_UNIQUE` (`idOffer` ASC) VISIBLE,
  INDEX `fkEntityOffer` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityOffer`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
AUTO_INCREMENT = 76
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`person`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`person` (
  `idEntity` BINARY(16) NOT NULL,
  `personFirstName` VARCHAR(128) NULL DEFAULT NULL,
  `personLastName` VARCHAR(128) NULL DEFAULT NULL,
  `personPreferredName` VARCHAR(128) NULL DEFAULT NULL,
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityPerson`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`place`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`place` (
  `idEntity` BINARY(16) NOT NULL,
  `placeType` INT NOT NULL,
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkEntityPlace`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`user` (
  `idEntity` BINARY(16) NOT NULL,
  `userName` VARCHAR(64) NOT NULL,
  `userPassword` VARCHAR(60) NOT NULL,
  `userSalt` VARCHAR(29) NOT NULL,
  `userPrimaryEmail` BIGINT UNSIGNED NOT NULL,
  `userTimeZone` TINYINT NOT NULL,
  `accountBalance` FLOAT NULL DEFAULT '0',
  PRIMARY KEY (`idEntity`),
  UNIQUE INDEX `idEntity_UNIQUE` (`idEntity` ASC) VISIBLE,
  INDEX `fkUserEmail` (`userPrimaryEmail` ASC) VISIBLE,
  CONSTRAINT `fkEntityUser`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`),
  CONSTRAINT `fkUserEmail`
    FOREIGN KEY (`userPrimaryEmail`)
    REFERENCES `factory`.`email` (`idEmail`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`reset-password-session`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`reset-password-session` (
  `idSession` BINARY(16) NOT NULL,
  `idEntity` BINARY(16) NOT NULL,
  `dtStarted` DATETIME NOT NULL,
  PRIMARY KEY (`idSession`),
  INDEX `fkUserFPS_idx` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkUserFPS`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`user` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`session`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`session` (
  `idEntity` BINARY(16) NOT NULL,
  `ipAddress` VARCHAR(255) NOT NULL,
  `browser` VARCHAR(255) NOT NULL,
  `screenWidth` INT NOT NULL,
  `screenHeight` INT NOT NULL,
  `referrerURL` VARCHAR(255) NOT NULL,
  `geolocation` VARCHAR(255) NOT NULL,
  `timeZone` VARCHAR(255) NOT NULL,
  `language` VARCHAR(255) NOT NULL,
  `dtCreated` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dtUpdated` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `cookiesEnabled` TINYINT(1) NULL DEFAULT '0',
  PRIMARY KEY (`idEntity`),
  CONSTRAINT `session_ibfk_1`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`entity` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `factory`.`user-session`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `factory`.`user-session` (
  `idSession` BINARY(16) NOT NULL,
  `idEntity` BINARY(16) NOT NULL,
  `dtStarted` DATETIME NOT NULL,
  `dtActive` DATETIME NOT NULL,
  `done` BIT(1) NOT NULL,
  PRIMARY KEY (`idSession`, `idEntity`),
  INDEX `fkUserUS` (`idEntity` ASC) VISIBLE,
  CONSTRAINT `fkUserUS`
    FOREIGN KEY (`idEntity`)
    REFERENCES `factory`.`user` (`idEntity`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;

USE `factory` ;

-- -----------------------------------------------------
-- procedure AddContact
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `AddContact`(IN firstName VARCHAR(255), IN lastName VARCHAR(255))
BEGIN INSERT INTO Contacts (FirstName, LastName) VALUES (firstName, lastName); END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure DeleteContact
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `DeleteContact`(IN contactID INT)
BEGIN DELETE FROM Contacts WHERE ContactID = contactID; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure GetContacts
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `GetContacts`()
BEGIN SELECT * FROM Contacts; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure UpdateContact
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `UpdateContact`(IN contactID INT, IN firstName VARCHAR(255), IN lastName VARCHAR(255))
BEGIN UPDATE Contacts SET FirstName = firstName, LastName = lastName WHERE ContactID = contactID; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteAddress
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteAddress`(IN p_idAddress BIGINT)
BEGIN
	DELETE FROM address WHERE idAddress = p_idAddress;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteAlphaCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteAlphaCode`(IN p_idAlphaCode INT)
BEGIN DELETE FROM alphacode WHERE idAlphaCode = p_idAlphaCode; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteApp
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteApp`(IN p_idEntity CHAR(36))
BEGIN DELETE FROM app WHERE idEntity = UUID_TO_BIN(p_idEntity); END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteCart
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteCart`(IN p_idUser CHAR(36))
BEGIN
	DELETE FROM cart WHERE idUser = UUID_TO_BIN(p_idUser);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteCartItem
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteCartItem`(IN p_idUser CHAR(36), IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM cart WHERE idEntity = UUID_TO_BIN(p_idEntity) AND idUser = UUID_TO_BIN(p_idUser);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteCreditCard
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteCreditCard`(IN p_idCreditCard bigint(20))
BEGIN
	DELETE FROM `credit-card` WHERE idCreditCard = p_idCreditCard;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEmail
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEmail`(IN p_idEmail BIGINT)
BEGIN
	DELETE FROM email WHERE idEmail = p_idEmail;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEntity`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM entity WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEntityArea
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEntityArea`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM `entity-area` WHERE  idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEntityMedia
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEntityMedia`(IN p_idMedia BIGINT)
BEGIN
	DELETE FROM `entity-media` WHERE idMedia = p_idMedia;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEntityMediaAll
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEntityMediaAll`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM `entity-media` WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEntityRelate
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEntityRelate`(IN p_idEntity CHAR(36), IN p_idRelated CHAR(36))
BEGIN
	DELETE FROM `entity-relate` WHERE idEntity = UUID_TO_BIN(p_idEntity) AND idRelated = UUID_TO_BIN(p_idRelated);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEntityRelateAll
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEntityRelateAll`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM `entity-relate` WHERE idEntity = UUID_TO_BIN(p_idEntity) OR idRelated = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEvent
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEvent`(IN p_idEvent BIGINT)
BEGIN
	DELETE FROM event WHERE idEvent = p_idEvent;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteEventChainEdit
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteEventChainEdit`(IN p_idEventChainEdit INT)
BEGIN
	DELETE FROM `event-chain-edit` WHERE  idEventChainEdit = p_idEventChainEdit;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteGroup
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteGroup`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM `group` WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteItem
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteItem`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM item WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteLocation
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteLocation`(IN p_idLocation BIGINT)
BEGIN
	DELETE FROM location WHERE idLocation = p_idLocation;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteMasterType
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteMasterType`(IN p_idMasterType INT)
BEGIN
	DELETE FROM `master-type` WHERE  idMasterType = p_idMasterType;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteModifyCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteModifyCode`(IN p_idModifyCode BIGINT)
BEGIN DELETE FROM `modify-code` WHERE idModifyCode = p_idModifyCode; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteOffer
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteOffer`(IN p_idOffer INT)
BEGIN
	DELETE FROM offer WHERE idOffer = p_idOffer;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deletePerson
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deletePerson`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM person WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deletePlace
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deletePlace`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM place WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteResetPasswordSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteResetPasswordSession`(IN p_idSession CHAR(36))
BEGIN
	DELETE FROM `reset-password-session` WHERE idSession = UUID_TO_BIN(p_idSession);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteSession`(IN p_idEntity CHAR(36))
BEGIN DELETE FROM session WHERE idEntity = UUID_TO_BIN(p_idEntity); END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteUser
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteUser`(IN p_idEntity CHAR(36))
BEGIN
	DELETE FROM user WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure deleteUserSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `deleteUserSession`(IN p_idSession CHAR(36))
BEGIN
	DELETE FROM `user-session` WHERE idSession = UUID_TO_BIN(p_idSession);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertAddress
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertAddress`(IN p_name varchar(100), 
    IN p_idLocation bigint(20))
BEGIN
	INSERT INTO address (name, idLocation) 
    VALUES (p_name, p_idLocation);
	SELECT LAST_INSERT_ID() AS idAddress;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertAlphaCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertAlphaCode`(IN p_code VARCHAR(7), IN p_value FLOAT, IN p_used BOOLEAN)
BEGIN INSERT INTO alphacode (code, value, used) VALUES (p_code, p_value, p_used); SELECT LAST_INSERT_ID() AS idAlphaCode; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertApp
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertApp`(IN p_idEntity CHAR(36), IN p_appName VARCHAR(58), IN p_cloneUrl VARCHAR(255), IN p_version INT)
BEGIN
    DECLARE v_port INT;
    DECLARE v_appCode VARCHAR(70);  -- Adjust length as needed
    DECLARE v_unique BOOL DEFAULT FALSE;
    DECLARE v_randomNumber CHAR(6);
    DECLARE v_appNameNoSpaces VARCHAR(58);

    -- Call the selectNextPort procedure to get the next available port
    CALL selectNextPort(v_port);

    -- Remove spaces from appName and convert to lowercase
    SET v_appNameNoSpaces = LOWER(REPLACE(p_appName, ' ', ''));

    -- Generate a unique appCode by combining processed appName and a random six-digit number
    WHILE NOT v_unique DO
        -- Generate a random six-digit number
        SET v_randomNumber = LPAD(FLOOR(RAND() * 1000000), 6, '0');
        SET v_appCode = CONCAT(v_appNameNoSpaces, v_randomNumber);

        -- Check if the generated appCode is unique
        IF NOT EXISTS (SELECT 1 FROM app WHERE appCode = v_appCode) THEN
            SET v_unique = TRUE;
        END IF;
    END WHILE;

    -- Insert the new app into the app table with the derived appCode and port value
    INSERT INTO app (idEntity, appName, appCode, port, cloneUrl, version, dtCreated, dtUpdated) 
    VALUES (UUID_TO_BIN(p_idEntity), p_appName, v_appCode, v_port, p_cloneUrl, p_version, NOW(), NOW());

    -- Return the new row that was inserted
    SELECT BIN_TO_UUID(idEntity) AS idEntity, appCode, port FROM app WHERE appCode = v_appCode;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertCart
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertCart`(IN p_idEntity CHAR(36), IN p_idUser CHAR(36), IN p_quantity INT, IN p_idOffer INT(10))
BEGIN
	INSERT INTO cart (idUser, idEntity, quantity, idOffer) VALUES(UUID_TO_BIN(p_idUser), UUID_TO_BIN(p_idEntity), p_quantity, p_idOffer);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertCreditCard
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertCreditCard`(IN p_number varchar(16), 
    IN p_expiration date, 
    IN p_ccv varchar(4), 
    IN p_idAddressBilling bigint(20))
BEGIN
	INSERT INTO `credit-card` (number, expiration, ccv, idAddressBilling) 
    VALUES (p_number, p_expiration, p_ccv, p_idAddressBilling);
	SELECT LAST_INSERT_ID() AS idCreditCard;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEmail
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEmail`(IN p_idEntity CHAR(36), IN p_emailAddress VARCHAR(320), IN p_emailVerifyCode CHAR(6))
BEGIN
	INSERT INTO email (idEntity, emailAddress, emailVerifyCode) VALUES(UUID_TO_BIN(p_idEntity), p_emailAddress, p_emailVerifyCode);
	SELECT LAST_INSERT_ID() AS idEmail;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEntity`(IN p_entityTitle VARCHAR(255), IN p_entityDesc TEXT, IN p_entityType INT)
BEGIN
	SET @idEntity = UUID_TO_BIN(UUID());
	INSERT INTO entity (idEntity, entityTitle, entityDesc, entityType, dtCreated) VALUES(@idEntity, p_entityTitle, p_entityDesc, p_entityType, Now());
	SELECT BIN_TO_UUID(@idEntity) as idEntity;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEntityArea
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEntityArea`(IN p_idEntity CHAR(36), IN p_idAddress INT, IN p_postalCode VARCHAR(12), IN p_mileRadius INT)
BEGIN
	INSERT INTO `entity-area` (idEntity, idAddress, postalCode, mileRadius) 
    VALUES (UUID_TO_BIN(p_idEntity), p_idAddress, p_postalCode, p_mileRadius);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEntityMedia
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEntityMedia`(IN p_idEntity CHAR(36), IN p_idUser CHAR(36), IN p_mediaType INT, IN p_fileName VARCHAR(50), IN p_sortOrder INT, IN p_xOffset FLOAT, IN p_yOffset FLOAT, IN p_scale FLOAT)
BEGIN
	INSERT INTO `entity-media` (idEntity, idUser, mediaType, fileName, dtCreated, sortOrder, xOffset, yOffset, scale) 
	VALUES(UUID_TO_BIN(p_idEntity), UUID_TO_BIN(p_idUser), p_mediaType, p_fileName, Now(), p_sortOrder, p_xOffset, p_yOffset, p_scale);
	SELECT LAST_INSERT_ID() AS idMedia;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEntityRelate
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEntityRelate`(IN p_idEntity CHAR(36), IN p_idRelated CHAR(36), IN p_relateType INT)
BEGIN
	INSERT INTO `entity-relate` (idEntity, idRelated, relateType) VALUES(UUID_TO_BIN(p_idEntity), UUID_TO_BIN(p_idRelated), p_relateType);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEvent
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEvent`(IN p_idEntity char(36),
  IN p_eventType TINYINT,
  IN p_dtStart DATETIME,
  IN p_dtEnd DATETIME,
  IN p_allDay bit(1),
  IN p_repeatType TINYINT,
  IN p_repeatTimeFrame TINYINT,
  IN p_repeatMonthlyType TINYINT,
  IN p_repeatInterval SMALLINT,
  IN p_repeatSun bit(1),
  IN p_repeatMon bit(1),
  IN p_repeatTue bit(1),
  IN p_repeatWed bit(1),
  IN p_repeatThu bit(1),
  IN p_repeatFri bit(1),
  IN p_repeatSat bit(1),
  IN p_repeatEndType tinyint,
  IN p_repeatEnd datetime,
  IN p_repeatOccurences smallint, 
  IN p_allServices bit(1))
BEGIN
	INSERT INTO event (idEntity,
            eventType,
            dtStart,
            dtEnd,
            allDay,
            repeatType,
            repeatTimeFrame,
            repeatMonthlyType,
            repeatInterval,
            repeatSun,
            repeatMon,
            repeatTue,
            repeatWed,
            repeatThu,
            repeatFri,
            repeatSat,
            repeatEndType,
            repeatEnd,
            repeatOccurences,
            allServices) 
    VALUES (UUID_TO_BIN(p_idEntity),
            p_eventType,
            p_dtStart,
            p_dtEnd,
            p_allDay,
            p_repeatType,
            p_repeatTimeFrame,
            p_repeatMonthlyType,
            p_repeatInterval,
            p_repeatSun,
            p_repeatMon,
            p_repeatTue,
            p_repeatWed,
            p_repeatThu,
            p_repeatFri,
            p_repeatSat,
            p_repeatEndType,
            p_repeatEnd,
            p_repeatOccurences, 
            p_allServices);
	SELECT LAST_INSERT_ID() AS idEvent;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertEventChainEdit
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertEventChainEdit`(IN p_idEvent int(10), IN p_editType tinyint, IN p_dtStart datetime, IN p_idNewEvent CHAR(36))
BEGIN
	INSERT INTO `event-chain-edit` (idEvent, editType, dtStart, idNewEvent) VALUES(p_idEvent, p_editType, p_dtStart, p_idNewEvent);
	SELECT LAST_INSERT_ID() as idEventChainEdit;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertGroup
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertGroup`(IN p_idEntity CHAR(36), IN p_groupType INT)
BEGIN
	INSERT INTO `group` (idEntity, groupType) VALUES(UUID_TO_BIN(p_idEntity), groupType);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertInteraction
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertInteraction`(IN p_idEntity CHAR(36), IN p_userPrompt TEXT, IN p_aiResponse TEXT, IN p_factoryAction VARCHAR(255), IN p_actionParameter VARCHAR(511), IN p_idApp CHAR(36), IN p_systemResponse TEXT)
BEGIN
    INSERT INTO interaction (idEntity, userPrompt, aiResponse, factoryAction, actionParameter, dtCreated, idApp, systemResponse) VALUES (UUID_TO_BIN(p_idEntity), p_userPrompt, p_aiResponse, p_factoryAction, p_actionParameter, NOW(), UUID_TO_BIN(p_idApp), p_systemResponse);
    SELECT LAST_INSERT_ID() AS idInteraction;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertItem
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertItem`(IN p_idEntity CHAR(36), IN p_condition INT)
BEGIN
	INSERT INTO item (idEntity, `condition`) VALUES(UUID_TO_BIN(p_idEntity), p_condition);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertLocation
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertLocation`(IN p_addressLine1 varchar(255), 
    IN p_addressLine2 varchar(255), 
    IN p_city varchar(255), 
    IN p_idProvince int(10), 
    IN p_idCountry int(10),
    IN p_postalCode varchar(12))
BEGIN
	INSERT INTO location (addressLine1, addressLine2, city, idProvince, idCountry, postalCode) 
    VALUES (p_addressLine1, p_addressLine2, p_city, p_idProvince, p_idCountry, p_postalCode);
	SELECT LAST_INSERT_ID() AS idLocation;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertMasterType
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertMasterType`(IN p_table VARCHAR(100), IN p_column VARCHAR(100), IN p_value VARCHAR(255), IN p_code VARCHAR(45))
BEGIN
	INSERT INTO `master-type` (`table`, `column`, value, code) VALUES (p_table, p_column, p_value, p_code);
	SELECT LAST_INSERTED_ID() as idMasterType;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertModifyCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertModifyCode`(IN p_idApp CHAR(36), IN p_changeSummary VARCHAR(2047), IN p_dbChanges TEXT, IN p_newClientImports TEXT, IN p_newServerImports TEXT, IN p_version INT, IN p_fixErrors TINYINT, IN p_errorText TEXT)
BEGIN
    INSERT INTO `modify-code` (idApp, changeSummary, dbChanges, newClientImports, newServerImports, version, fixErrors, errorText) 
    VALUES (UUID_TO_BIN(p_idApp), p_changeSummary, p_dbChanges, p_newClientImports, p_newServerImports, p_version, p_fixErrors, p_errorText);
    SELECT LAST_INSERT_ID() AS idModifyCode;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertOffer
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertOffer`(IN p_idEntity CHAR(36), 
    IN p_offerType smallint, 
    IN p_confirmMethod TINYINT,
    IN p_price float, 
    IN p_rateType smallint, 
    IN p_negotiable bit(1),
    IN p_quantify bit(1),
    IN p_quantity smallint,
    IN p_minTimeIncrement smallint,
    IN p_maxTimeIncrement SMALLINT,
    IN p_startTimeIncrement SMALLINT,
    IN p_bookingLeadNumber SMALLINT,
    IN p_bookingLeadType SMALLINT,
    IN p_cancelLeadNumber SMALLINT,
    IN p_cancelLeadType SMALLINT,
    IN p_cancelFee FLOAT,
    IN p_handlePayment bit(1),
    IN p_depositRequired TINYINT,
    IN p_cancelPolicyOn bit(1),
    IN p_cancelFeeType TINYINT,
    IN p_depositAmountType TINYINT,
    IN p_depositAmount FLOAT,
    IN p_serviceLocation TINYINT)
BEGIN
	INSERT INTO offer (idEntity, offerType, confirmMethod, price, rateType, negotiable, quantify, quantity, minTimeIncrement, maxTimeIncrement, startTimeIncrement, bookingLeadNumber, bookingLeadType, cancelLeadNumber, cancelLeadType, cancelFee, handlePayment, depositRequired, cancelPolicyOn, cancelFeeType, depositAmountType, depositAmount, serviceLocation) 
    VALUES (UUID_TO_BIN(p_idEntity), p_offerType, p_confirmMethod, p_price, p_rateType, p_negotiable, p_quantify, p_quantity, p_minTimeIncrement, p_maxTimeIncrement, p_startTimeIncrement, p_bookingLeadNumber, p_bookingLeadType, p_cancelLeadNumber, p_cancelLeadType, p_cancelFee, p_handlePayment, p_depositRequired, p_cancelPolicyOn, p_cancelFeeType, p_depositAmountType, p_depositAmount, p_serviceLocation);
  SELECT LAST_INSERT_ID() AS idOffer;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertPerson
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertPerson`(IN p_idEntity CHAR(36), IN p_personFirstName VARCHAR(128), IN p_personLastName VARCHAR(128), IN p_personPreferredName VARCHAR(128))
BEGIN
	INSERT INTO person (idEntity, personFirstName, personLastName, personPreferredName) VALUES(UUID_TO_BIN(p_idEntity), p_personFirstName, p_personLastName, p_personPreferredName);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertPlace
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertPlace`(IN p_idEntity CHAR(36), IN p_placeType INT)
BEGIN
	INSERT INTO place (idEntity, placeType) VALUES(UUID_TO_BIN(p_idEntity), placeType);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertResetPasswordSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertResetPasswordSession`(IN p_idEntity CHAR(36))
BEGIN
	SET @idSession = UUID();
	INSERT INTO `reset-password-session` (idSession, idEntity, dtStarted) VALUES(UUID_TO_BIN(@idSession), UUID_TO_BIN(p_idEntity), Now());
	SELECT @idSession as idSession;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertSession`(IN p_idEntity CHAR(36), IN p_ipAddress VARCHAR(255), IN p_browser VARCHAR(255), IN p_screenWidth INT, IN p_screenHeight INT, IN p_referrerURL VARCHAR(255), IN p_geolocation VARCHAR(255), IN p_timeZone VARCHAR(255), IN p_language VARCHAR(255), IN p_cookiesEnabled TINYINT(1))
BEGIN
    INSERT INTO session (idEntity, ipAddress, browser, screenWidth, screenHeight, referrerURL, geolocation, timeZone, language, dtCreated, dtUpdated, cookiesEnabled) 
    VALUES (UUID_TO_BIN(p_idEntity), p_ipAddress, p_browser, p_screenWidth, p_screenHeight, p_referrerURL, p_geolocation, p_timeZone, p_language, NOW(), NOW(), p_cookiesEnabled);
    SELECT p_idEntity AS idEntity;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertUser
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertUser`(IN p_idEntity CHAR(36), IN p_userName VARCHAR(255), IN p_userPassword VARCHAR(255), IN p_userSalt VARCHAR(255), IN p_userPrimaryEmail BIGINT, IN p_userTimeZone TINYINT, IN p_accountBalance FLOAT)
BEGIN
    INSERT INTO user (idEntity, userName, userPassword, userSalt, userPrimaryEmail, userTimeZone, accountBalance) VALUES(UUID_TO_BIN(p_idEntity), p_userName, p_userPassword, p_userSalt, p_userPrimaryEmail, p_userTimeZone, p_accountBalance);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure insertUserSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertUserSession`(IN p_idEntity CHAR(36))
BEGIN
	SET @idSession = UUID();
	SET @Now = Now();
	INSERT INTO `user-session` (idSession, idEntity, dtStarted, dtActive, done) VALUES(UUID_TO_BIN(@idSession), UUID_TO_BIN(p_idEntity), @Now, @Now, 0);
	SELECT @idSession as idSession;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectAddress
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectAddress`(IN p_idAddress bigint(20))
BEGIN
	SELECT idAddress, name, idLocation 
    FROM address
    WHERE idAddress = p_idAddress;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectAlphaCodeByCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectAlphaCodeByCode`(IN p_code VARCHAR(7))
BEGIN SELECT idAlphaCode, code, value, used FROM alphacode WHERE code = p_code; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectApp
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectApp`(IN p_idEntity CHAR(36))
BEGIN SELECT BIN_TO_UUID(idEntity) as idEntity, appName, appCode, port, dtCreated, dtUpdated FROM app WHERE idEntity = UUID_TO_BIN(p_idEntity); END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectAppByCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectAppByCode`(IN p_appCode VARCHAR(64))
BEGIN SELECT BIN_TO_UUID(idEntity) as idEntity, appName, appCode, port, dtCreated, dtUpdated FROM app WHERE appCode = p_appCode; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectAppInteractions
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectAppInteractions`(IN p_idApp CHAR(36))
BEGIN
    SELECT idInteraction, BIN_TO_UUID(idEntity) as idEntity, userPrompt, aiResponse, factoryAction, actionParameter, BIN_TO_UUID(idApp) as idApp, dtCreated, systemResponse
    FROM interaction
    WHERE idApp = UUID_TO_BIN(p_idApp)
    ORDER BY dtCreated ASC;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectAppsByUser
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectAppsByUser`(IN p_idEntity CHAR(36))
BEGIN
    SELECT BIN_TO_UUID(a.idEntity) as idEntity, a.appName, a.appCode, a.port, a.dtCreated, a.dtUpdated
    FROM app AS a
    JOIN `entity-relate` AS er ON a.idEntity = er.idEntity
    WHERE er.idRelated = UUID_TO_BIN(p_idEntity) AND er.relateType = 1;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectCart
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectCart`(IN p_idUser CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) AS idEntity, BIN_TO_UUID(idUser) AS idUser, quantity, idOffer
    	FROM cart as c
    	WHERE c.idUser = UUID_TO_BIN(p_idUser);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectCountryActive
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectCountryActive`()
BEGIN
	SELECT * FROM country WHERE active = 1;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectCreditCard
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectCreditCard`(IN p_idCreditCard bigint(20))
BEGIN
	SELECT idCreditCard, number, expiration, ccv, idAddressBilling
    FROM `credit-card`
    WHERE idCreditCard = p_idCreditCard;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEmail
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEmail`(IN p_idEmail BIGINT)
BEGIN
	SELECT idEmail, BIN_TO_UUID(idEntity) as idEntity, emailAddress, emailVerified, emailVerifyCode FROM email WHERE idEmail = p_idEmail;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEmailByEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEmailByEntity`(IN p_idEntity CHAR(36))
BEGIN
	SELECT idEmail, BIN_TO_UUID(idEntity) as idEntity, emailAddress, emailVerified, emailVerifyCode FROM email WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntity`(IN p_idEntity CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) AS idEntity, entityTitle, entityDesc, entityType, idMedia, dtCreated, dtLastEdited  FROM entity WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityArea
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityArea`(IN p_idEntity CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) as idEntity, idAddress, postalCode, mileRadius FROM `entity-area` where idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityByEntityType
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityByEntityType`(IN p_entityType INT)
BEGIN
	SELECT BIN_TO_UUID(idEntity) AS idEntity, entityTitle, entityDesc, entityType, idMedia, dtCreated, dtLastEdited FROM entity WHERE entityType = p_entityType;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityByOwner
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityByOwner`(IN p_idEntity CHAR(36), IN p_entityType INT)
BEGIN
	SELECT BIN_TO_UUID(e.idEntity) AS idEntity, e.entityTitle, e.entityDesc, e.entityType, e.idMedia, e.dtCreated, e.dtLastEdited, 
    o.idOffer, o.offerType, o.confirmMethod, o.price, o.rateType, o.negotiable, o.quantify, o.quantity, 
	o.minTimeIncrement, o.maxTimeIncrement, o.startTimeIncrement, o.bookingLeadNumber, o.bookingLeadType,
	o.cancelLeadNumber, o.cancelLeadType, o.cancelFee, o.handlePayment, o.depositRequired, o.cancelPolicyOn, o.cancelFeeType, o.depositAmountType, o.depositAmount
	FROM entity AS e 
		RIGHT JOIN `entity-relate` AS er ON er.idEntity = e.idEntity
		LEFT OUTER JOIN offer AS o ON o.idEntity = e.idEntity
	WHERE idRelated = UUID_TO_BIN(p_idEntity) AND er.relateType = 1 AND entityType = p_entityType
	ORDER BY dtCreated DESC;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityBySearch
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityBySearch`(IN p_searchValue CHAR(255))
BEGIN
  SELECT * FROM 
	  (SELECT BIN_TO_UUID(e.idEntity) AS idEntity, e.entityTitle, e.entityDesc, e.entityType, e.idMedia, e.dtCreated, e.dtLastEdited, em.fileName, em.mediaType, em.xOffset, em.yOffset 
		FROM entity AS e, `entity-media` as em
		WHERE e.idMedia = em.idMedia
	  UNION ALL 
	  SELECT BIN_TO_UUID(e.idEntity) AS idEntity, e.entityTitle, e.entityDesc, e.entityType, e.idMedia, e.dtCreated, e.dtLastEdited, NULL, NULL, 0, 0
		FROM entity AS e
		WHERE e.idMedia is NULL) `combined-alias`
	 ORDER BY dtCreated DESC;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityMedia
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityMedia`(IN p_idMedia BIGINT)
BEGIN
	SELECT idMedia, BIN_TO_UUID(idEntity) as idEntity, BIN_TO_UUID(idUser) as idUser, mediaType, fileName, dtCreated, sortOrder, xOffset, yOffset, scale 
	FROM `entity-media` WHERE idMedia = p_idMedia;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityMediaByEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityMediaByEntity`(IN p_idEntity CHAR(36))
BEGIN
	SELECT idMedia, BIN_TO_UUID(idEntity) as idEntity, BIN_TO_UUID(idUser) as idUser, mediaType, fileName, dtCreated, sortOrder, xOffset, yOffset, scale
	FROM `entity-media` WHERE idEntity = UUID_TO_BIN(p_idEntity) ORDER BY sortOrder ASC;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityRelate
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityRelate`(IN p_idEntity CHAR(36), IN p_relateType INT)
BEGIN
	(SELECT BIN_TO_UUID(e.idEntity) AS idEntity, e.entityTitle, e.entityDesc, e.entityType, e.idMedia, e.dtCreated, e.dtLastEdited, em.fileName, em.mediaType, em.xOffset, em.yOffset, em.scale 
		FROM entity AS e, `entity-media` as em, `entity-relate` as er
		WHERE er.idEntity = UUID_TO_BIN(p_idEntity) AND er.relateType = p_relateType AND er.idRelated = e.idEntity AND e.idMedia = em.idMedia)
	UNION ALL 
  	(SELECT BIN_TO_UUID(e.idEntity) AS idEntity, e.entityTitle, e.entityDesc, e.entityType, e.idMedia, e.dtCreated, e.dtLastEdited, NULL as fileName, NULL as mediaType, 0 as xOffset, 0 as yOffset, 0 as scale
    	FROM entity AS e, `entity-relate` as er
    	WHERE er.idEntity = UUID_TO_BIN(p_idEntity) AND er.relateType = p_relateType AND er.idRelated = e.idEntity AND e.idMedia is NULL);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEntityRelateByRelated
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEntityRelateByRelated`(IN p_idRelated CHAR(36))
BEGIN
	SELECT * FROM `entity-relate` WHERE idRelated = UUID_TO_BIN(p_idRelated);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEvent
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEvent`(IN p_idEntity CHAR(36))
BEGIN
	SELECT idEvent, 
            BIN_TO_UUID(idEntity) as idEntity,
            eventType,
            dtStart,
            dtEnd,
            allDay,
            repeatType,
            repeatTimeFrame,
            repeatMonthlyType,
            repeatInterval,
            repeatSun,
            repeatMon,
            repeatTue,
            repeatWed,
            repeatThu,
            repeatFri,
            repeatSat,
            repeatEndType,
            repeatEnd,
            repeatOccurences,
            allServices
    FROM event
    WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectEventChainEdit
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectEventChainEdit`(IN p_idEvent INT)
BEGIN
	SELECT idEventChainEdit, idEvent, editType, dtStart, idNewEvent FROM `event-chain-edit` where idEvent = p_idEvent;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectGroup
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectGroup`(IN p_idEntity CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) as idEntity, groupType FROM `group` where idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectItem
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectItem`(IN p_idEntity CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) as idEntity, `condition` FROM item WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectLocation
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectLocation`(IN p_idLocation bigint(20))
BEGIN
	SELECT idLocation, addressLine1, addressLine2, city, idProvince, idCountry, postalCode 
    FROM location
    WHERE idLocation = p_idLocation;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectMasterType
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectMasterType`(IN p_idMasterType INT)
BEGIN
	SELECT * FROM `master-type` WHERE idMasterType = p_idMasterType;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectMasterTypeByValue
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectMasterTypeByValue`(IN p_value VARCHAR(255))
BEGIN
	SELECT * FROM `master-type` WHERE value = p_value;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectModifyCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectModifyCode`(IN p_idModifyCode BIGINT)
BEGIN SELECT idModifyCode, BIN_TO_UUID(idApp) as idApp, dtCreated, changeSummary, dbChanges, newClientImports, newServerImports, version FROM `modify-code` WHERE idModifyCode = p_idModifyCode; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectModifyCodeByApp
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectModifyCodeByApp`(IN p_idApp CHAR(36))
BEGIN SELECT BIN_TO_UUID(idApp) as idApp, dtCreated, changeSummary, dbChanges, newClientImports, newServerImports, version FROM `modify-code` WHERE idApp = UUID_TO_BIN(p_idApp); 
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectNextPort
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectNextPort`(OUT previous_port INT)
BEGIN
    DECLARE current_port INT;

    -- Select the current port value and lock the row for update
    SELECT `port` INTO current_port FROM `next-port` FOR UPDATE;

    -- Update the port value by adding 12
    UPDATE `next-port` SET `port` = `port` + 12 WHERE `port`=current_port;

    -- Set the OUT parameter
    SET previous_port = current_port;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectOffer
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectOffer`(IN p_idOffer bigint(20))
BEGIN
	SELECT idOffer, BIN_TO_UUID(idEntity) AS idEntity, offerType, confirmMethod, price, rateType, negotiable, quantify, quantity, minTimeIncrement, maxTimeIncrement, startTimeIncrement, bookingLeadNumber, bookingLeadType, cancelLeadNumber, cancelLeadType, cancelFee, handlePayment, depositRequired, cancelPolicyOn, cancelFeeType, depositAmountType, depositAmount, serviceLocation
  FROM offer
  WHERE idOffer = p_idOffer;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectOfferForEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectOfferForEntity`(IN p_idEntity CHAR(36))
BEGIN
	SELECT idOffer, BIN_TO_UUID(idEntity) AS idEntity,offerType, confirmMethod, price, rateType, negotiable, quantify, quantity, minTimeIncrement, maxTimeIncrement, startTimeIncrement, bookingLeadNumber, bookingLeadType, cancelLeadNumber, cancelLeadType, cancelFee, handlePayment, depositRequired, cancelPolicyOn, cancelFeeType, depositAmountType, depositAmount, serviceLocation
  FROM offer
  WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectPerson
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectPerson`(IN p_idEntity CHAR(36))
BEGIN
	SELECT * FROM person WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectPlace
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectPlace`(IN p_idEntity CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) as idEntity, placeType FROM place where idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectProviderUnconfirmedCount
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectProviderUnconfirmedCount`(IN p_idEntity CHAR(36))
BEGIN
    SELECT COUNT(e.idEvent) as unconfirmedBookings
    FROM event AS e, booking AS b
    WHERE e.idEntity = UUID_TO_BIN(p_idEntity) AND eventType = 3 AND e.idEvent = b.idEvent AND confirmed = 0;    
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectProvinceByCountry
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectProvinceByCountry`(IN p_idCountry INT)
BEGIN
	SELECT * FROM province WHERE idCountry = p_idCountry AND active = 1;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectResetPasswordSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectResetPasswordSession`(IN p_idSession CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idSession) AS idSession, BIN_TO_UUID(idEntity) AS idEntity, dtStarted 
	FROM `reset-password-session` WHERE idSession = UUID_TO_BIN(p_idSession);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectSession`(IN p_idEntity CHAR(36))
BEGIN SELECT BIN_TO_UUID(idEntity) as idEntity, ipAddress, browser, screenWidth, screenHeight, referrerURL, geolocation, timeZone, language, cookiesEnabled FROM session WHERE idEntity = UUID_TO_BIN(p_idEntity); END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectUser
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectUser`(IN p_idEntity CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) as idEntity, userName, userPassword, userSalt, userPrimaryEmail, userTimeZone FROM user WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectUserByEmail
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectUserByEmail`(IN p_emailAddress VARCHAR(320))
BEGIN
	SELECT BIN_TO_UUID(u.idEntity) as idEntity, u.userName, u.userPassword, u.userSalt, u.userPrimaryEmail, e.emailAddress, e.emailVerified, u.userTimeZone, u.accountBalance, p.personFirstName, p.personLastName
	FROM user AS u, email AS e, person p 
    WHERE u.idEntity = e.idEntity AND p.idEntity = u.idEntity AND e.emailAddress = p_emailAddress;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectUserByUserName
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectUserByUserName`(IN p_userName CHAR(64))
BEGIN
	SELECT BIN_TO_UUID(u.idEntity) as idEntity, u.userName, u.userPassword, u.userSalt, u.userPrimaryEmail, e.entityTitle, u.userTimeZone
    FROM user AS u, entity AS e
    WHERE userName = p_userName AND e.idEntity = u.idEntity;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectUserEvents
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectUserEvents`(IN p_idEntity CHAR(36))
BEGIN
	(SELECT idEvent, 
            BIN_TO_UUID(idEntity) as idEntity,
            eventType,
            dtStart,
            dtEnd,
            allDay,
            repeatType,
            repeatTimeFrame,
            repeatMonthlyType,
            repeatInterval,
            repeatSun,
            repeatMon,
            repeatTue,
            repeatWed,
            repeatThu,
            repeatFri,
            repeatSat,
            repeatEndType,
            repeatEnd,
            repeatOccurences,
            allServices,
            null as idBooking,
            null as idAvailability,
            null as idConsumer,
            null as consumerTitle,
            null as idService,
            null as confirmed
    FROM event
    WHERE idEntity = UUID_TO_BIN(p_idEntity) AND eventType < 2)
    UNION ALL 
    (SELECT e.idEvent, 
            BIN_TO_UUID(e.idEntity) as idEntity,
            eventType,
            dtStart,
            dtEnd,
            allDay,
            repeatType,
            repeatTimeFrame,
            repeatMonthlyType,
            repeatInterval,
            repeatSun,
            repeatMon,
            repeatTue,
            repeatWed,
            repeatThu,
            repeatFri,
            repeatSat,
            repeatEndType,
            repeatEnd,
            repeatOccurences,
            allServices,
            idBooking,
            idAvailability,
            BIN_TO_UUID(idConsumer) as idConsumer,
            en.entityTitle as consumerTitle,
            BIN_TO_UUID(idService) as idService,
            confirmed
    FROM event AS e, booking AS b, entity AS en
    WHERE e.idEntity = UUID_TO_BIN(p_idEntity) AND eventType = 3 AND e.idEvent = b.idEvent AND en.idEntity = b.idConsumer AND confirmed <> 2)
    ORDER BY eventType ASC, dtStart ASC, dtEnd ASC, idService ASC;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure selectUserSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `selectUserSession`(IN p_idSession CHAR(36))
BEGIN
	SELECT BIN_TO_UUID( idSession) as idSession, BIN_TO_UUID( idEntity ) as idEntity, dtStarted, dtActive, done
	FROM `user-session` WHERE idSession = UUID_TO_BIN(p_idSession);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateAddress
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateAddress`(IN p_idAddress bigint(20), 
    IN p_name varchar(100), 
    IN p_idLocation  bigint(20))
BEGIN
	UPDATE address 
    SET name = p_name, idLocation = p_idLocation 
    WHERE idAddress = p_idAddress;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateAlphaCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateAlphaCode`(IN p_idAlphaCode INT, IN p_code VARCHAR(7), IN p_value FLOAT, IN p_used BOOLEAN)
BEGIN UPDATE alphacode SET code = p_code, value = p_value, used = p_used WHERE idAlphaCode = p_idAlphaCode; END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateApp
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateApp`(IN p_idEntity CHAR(36), IN p_appName VARCHAR(58), IN p_cloneUrl VARCHAR(255), IN p_version INT)
BEGIN
    UPDATE app SET appName = p_appName, cloneUrl = p_cloneUrl, version = p_version, dtUpdated = NOW() WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateCartItem
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateCartItem`(IN p_idEntity CHAR(36), IN p_idUser CHAR(36), IN p_quantity INT, IN p_idOffer INT(10))
BEGIN
	UPDATE cart SET quantity=p_quantity, idOffer=p_idOffer WHERE idUser = UUID_TO_BIN(p_idUser) AND idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateCreditCard
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateCreditCard`(IN p_idCreditCard bigint(20), 
    IN p_number varchar(16), 
    IN p_expiration date, 
    IN p_ccv varchar(4), 
    IN p_idAddressBilling bigint(20))
BEGIN
	UPDATE `credit-card` 
    SET number = p_number, expiration = p_expiration, ccv = p_ccv, idAddressBilling = p_idAddressBilling
    WHERE idCreditCard = p_idCreditCard;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateEmail
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateEmail`(IN p_idEmail BIGINT, IN p_emailAddress VARCHAR(320), IN p_emailVerified TINYINT(1), IN p_emailVerifyCode CHAR(6))
BEGIN
	UPDATE email SET emailAddress = p_emailAddress, emailVerified = p_emailVerified, emailVerifyCode = p_emailVerifyCode WHERE idEmail = p_idEmail;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateEntity
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateEntity`(IN p_idEntity CHAR(36), IN p_entityTitle VARCHAR(255), IN p_entityDesc TEXT)
BEGIN
	UPDATE entity 
  SET entityTitle = p_entityTitle, entityDesc = p_entityDesc, dtLastEdited = Now() 
  WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateEntityArea
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateEntityArea`(IN p_idEntity CHAR(36), IN p_idAddress INT, IN p_postalCode VARCHAR(12), IN p_mileRadius INT)
BEGIN
	UPDATE `entity-area` SET idAddress = p_idAddress, postalCode = p_postalCode, mileRadius = p_mileRadius
	WHERE  idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateEntityMedia
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateEntityMedia`(IN p_idMedia BIGINT, IN p_sortOrder INT, IN p_xOffset FLOAT, IN p_yOffset FLOAT, IN p_scale FLOAT)
BEGIN
	UPDATE `entity-media` SET sortOrder = p_sortOrder, xOffset = p_xOffset, yOffset = p_yOffset, scale = p_scale WHERE idMedia = p_idMedia;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateEntityPrimaryMedia
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateEntityPrimaryMedia`(IN p_idEntity CHAR(36), IN p_idMedia BIGINT)
BEGIN
  UPDATE entity
  SET idMedia = p_idMedia
  WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateEvent
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateEvent`(IN p_idEvent bigint, 
  IN p_idEntity char(36),
  IN p_eventType TINYINT,
  IN p_dtStart DATETIME,
  IN p_dtEnd DATETIME,
  IN p_allDay bit(1),
  IN p_repeatType TINYINT,
  IN p_repeatTimeFrame TINYINT,
  IN p_repeatMonthlyType TINYINT,
  IN p_repeatInterval SMALLINT,
  IN p_repeatSun bit(1),
  IN p_repeatMon bit(1),
  IN p_repeatTue bit(1),
  IN p_repeatWed bit(1),
  IN p_repeatThu bit(1),
  IN p_repeatFri bit(1),
  IN p_repeatSat bit(1),
  IN p_repeatEndType tinyint,
  IN p_repeatEnd datetime,
  IN p_repeatOccurences smallint,
  IN p_allServices bit(1))
BEGIN
	UPDATE event 
    SET idEntity = UUID_TO_BIN(p_idEntity),
          eventType = p_eventType,
          dtStart = p_dtStart,
          dtEnd = p_dtEnd,
          allDay = p_allDay,
          repeatType = p_repeatType,
          repeatTimeFrame = p_repeatTimeFrame,
          repeatMonthlyType = p_repeatMonthlyType,
          repeatInterval = p_repeatInterval,
          repeatSun = p_repeatSun,
          repeatMon = p_repeatMon,
          repeatTue = p_repeatTue,
          repeatWed = p_repeatWed,
          repeatThu = p_repeatThu,
          repeatFri = p_repeatFri,
          repeatSat = p_repeatSat,
          repeatEndType = p_repeatEndType,
          repeatEnd = p_repeatEnd,
          repeatOccurences = p_repeatOccurences,
          allServices = p_allServices
    WHERE idEvent = p_idEvent;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateGroup
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateGroup`(IN p_idEntity CHAR(36), IN p_groupType INT)
BEGIN
	UPDATE `group` SET groupType = p_groupType WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateInteraction
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateInteraction`(IN p_idInteraction BIGINT, IN p_systemResponse TEXT)
BEGIN
    UPDATE interaction SET systemResponse = p_systemResponse WHERE idInteraction = p_idInteraction;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateItem
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateItem`(IN p_idEntity CHAR(36), IN p_condition INT)
BEGIN
	UPDATE item SET `condition`=p_condition WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateLocation
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateLocation`(IN p_idLocation bigint(20), 
    IN p_addressLine1 varchar(255), 
    IN p_addressLine2 varchar(255), 
    IN p_city varchar(255), 
    IN p_idProvince int(10), 
    IN p_idCountry int(10),
    IN p_postalCode varchar(12))
BEGIN
	UPDATE location 
    SET addressLine1 = p_addressLine1, addressLine2 = p_addressLine2, city = p_city, 
        idProvince = p_idProvince, idCountry = p_idCountry, postalCode = p_postalCode 
    WHERE idLocation = p_idLocation;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateMasterType
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateMasterType`(IN p_idMasterType INT, IN p_attrDesc VARCHAR(1024), IN p_attrType INT, IN p_idSuggestor CHAR(36))
BEGIN
	UPDATE `master-type` SET `table` = p_table, `column` = p_column, value = p_value, code = p_code
	WHERE  idMasterType = p_idMasterType;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateModifyCode
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateModifyCode`(IN p_idModifyCode BIGINT, IN p_idApp CHAR(36), IN p_changeSummary VARCHAR(255), IN p_dbChanges TEXT, IN p_newClientImports TEXT, IN p_newServerImports TEXT, IN p_version INT, IN p_fixErrors TINYINT, IN p_errorText TEXT)
BEGIN
    UPDATE `modify-code` SET idApp = UUID_TO_BIN(p_idApp), changeSummary = p_changeSummary, dbChanges = p_dbChanges, newClientImports = p_newClientImports, newServerImports = p_newServerImports, version = p_version, fixErrors = p_fixErrors, errorText = p_errorText WHERE idModifyCode = p_idModifyCode;
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateOffer
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateOffer`(IN p_idOffer bigint(20), 
    IN p_idEntity CHAR(36),
    IN p_offerType smallint, 
    IN p_confirmMethod TINYINT,
    IN p_price float, 
    IN p_rateType smallint,
    IN p_negotiable bit(1),
    IN p_quantify bit(1),
    IN p_quantity smallint,
    IN p_minTimeIncrement smallint,
    IN p_maxTimeIncrement SMALLINT,
    IN p_startTimeIncrement SMALLINT,
    IN p_bookingLeadNumber SMALLINT,
    IN p_bookingLeadType SMALLINT,
    IN p_cancelLeadNumber SMALLINT,
    IN p_cancelLeadType SMALLINT,
    IN p_cancelFee FLOAT,
    IN p_handlePayment bit(1),
    IN p_depositRequired TINYINT,
    IN p_cancelPolicyOn bit(1),
    IN p_cancelFeeType TINYINT,
    IN p_depositAmountType TINYINT,
    IN p_depositAmount FLOAT,
    IN p_serviceLocation TINYINT)
BEGIN
	UPDATE offer 
  SET offerType=p_offerType, confirmMethod=p_confirmMethod, price=p_price, rateType=p_rateType, negotiable=p_negotiable, quantify=p_quantify, quantity=p_quantity,  
    minTimeIncrement=p_minTimeIncrement, maxTimeIncrement = p_maxTimeIncrement, startTimeIncrement = p_startTimeIncrement, 
    bookingLeadNumber = p_bookingLeadNumber, bookingLeadType = p_bookingLeadType, 
    cancelLeadNumber = p_cancelLeadNumber, cancelLeadType = p_cancelLeadType, 
    cancelFee = p_cancelFee, handlePayment = p_handlePayment, depositRequired = p_depositRequired, cancelPolicyOn=p_cancelPolicyOn, cancelFeeType = p_cancelFeeType,
    depositAmountType = p_depositAmountType, depositAmount = p_depositAmount, serviceLocation = p_serviceLocation
  WHERE idOffer = p_idOffer AND idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updatePerson
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updatePerson`(IN p_idEntity CHAR(36), IN p_personFirstName VARCHAR(128), IN p_personLastName VARCHAR(128), IN p_personPreferredName VARCHAR(128))
BEGIN
	UPDATE person SET personFirstName = p_personFirstName, personLastName = p_personLastName, personPreferredName = p_personPreferredName WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updatePlace
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updatePlace`(IN p_idEntity CHAR(36), IN p_placeType INT)
BEGIN
	UPDATE place SET placeType = p_placeType WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateSession`(IN p_idEntity CHAR(36), IN p_ipAddress VARCHAR(255), IN p_browser VARCHAR(255), IN p_screenWidth INT, IN p_screenHeight INT, IN p_referrerURL VARCHAR(255), IN p_geolocation VARCHAR(255), IN p_timeZone VARCHAR(255), IN p_language VARCHAR(255), IN p_cookiesEnabled BOOLEAN)
BEGIN
    UPDATE session 
    SET ipAddress = p_ipAddress, browser = p_browser, screenWidth = p_screenWidth, screenHeight = p_screenHeight, referrerURL = p_referrerURL, geolocation = p_geolocation, timeZone = p_timeZone, language = p_language, cookiesEnabled = p_cookiesEnabled, dtUpdated = NOW()
    WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateUser
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateUser`(IN p_idEntity CHAR(36), IN p_userName VARCHAR(255), IN p_userPassword VARCHAR(255), IN p_userSalt VARCHAR(255), IN p_userPrimaryEmail BIGINT, IN p_userTimeZone TINYINT, IN p_accountBalance FLOAT)
BEGIN
    UPDATE user SET userName = p_userName, userPassword = p_userPassword, userSalt = p_userSalt, userPrimaryEmail = p_userPrimaryEmail, userTimeZone = p_userTimeZone, accountBalance = p_accountBalance WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateUserBalance
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateUserBalance`(IN p_idEntity CHAR(36), IN p_accountBalance FLOAT)
BEGIN
    UPDATE user SET accountBalance = p_accountBalance WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateUserName
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateUserName`(IN p_idEntity CHAR(36), IN p_userName VARCHAR(64))
BEGIN
	UPDATE user SET userName = p_userName WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateUserPrimaryEmail
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateUserPrimaryEmail`(IN p_idEntity CHAR(36), IN p_userPrimaryEmail BIGINT)
BEGIN
	UPDATE user SET userPrimaryEmail = p_userPrimaryEmail WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateUserProfile
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateUserProfile`(IN p_idEntity CHAR(36), IN p_userName VARCHAR(64), IN p_userTimeZone TINYINT)
BEGIN
	UPDATE user SET userName = p_userName, userTimeZone = p_userTimeZone WHERE idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure updateUserSession
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `updateUserSession`(IN p_idSession CHAR(36), IN p_idEntity CHAR(36), IN p_done BIT(1))
BEGIN
	UPDATE `user-session` SET dtActive = Now(), done = p_done WHERE idSession = UUID_TO_BIN(p_idSession) AND idEntity = UUID_TO_BIN(p_idEntity);
END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure verifyEntityRelate
-- -----------------------------------------------------

DELIMITER $$
USE `factory`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `verifyEntityRelate`(IN p_idEntity CHAR(36), IN p_idRelated CHAR(36))
BEGIN
	SELECT BIN_TO_UUID(idEntity) as idEntity, relateType, BIN_TO_UUID(idRelated) as idRelated 
	FROM `entity-relate` 
	WHERE idEntity = UUID_TO_BIN(p_idEntity) AND idRelated = UUID_TO_BIN(p_idRelated);
END$$

DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
